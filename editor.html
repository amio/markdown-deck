<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script type="module" src="dist/index.min.js"></script>
    <title>markdown-deck | the web component for presenters</title>
    <style>
      html, body { height: 100%; margin: 0 }
      body { display: grid; grid-template-columns: 1fr 2fr }
      textarea { border: none; margin: 1px; padding: 1em; background-color: #FAFAFA }
      textarea { font: 16px/1.6em monospace }
    </style>
  </head>

  <body>
    <textarea id="editor" focus></textarea>
    <markdown-deck id="preview" hotkey>
      <style>
        @import url("https://fonts.googleapis.com/css?family=Roboto+Slab:400,400i");
        .slide { font-family: "Roboto Slab", serif }
        strong { color: #63F }
      </style>
    </markdown-deck>
    <script type="module">
      const editor = document.querySelector('#editor')
      const preview = document.querySelector('#preview')

      const syncMarkdown = () => {
        // calc current page number
        const textBeforeCaret = editor.value.substr(0, editor.selectionStart)
        const pageIndex = textBeforeCaret.split('\n---\n').length - 1

        preview.index = pageIndex
        preview.markdown = editor.value

        sessionStorage.setItem('markdown', editor.value)
      }

      editor.addEventListener('input', syncMarkdown)
      editor.addEventListener('change', syncMarkdown)
      editor.addEventListener('keyup', syncMarkdown)
      editor.addEventListener('click', syncMarkdown)

      function init () {
        const stored = sessionStorage.getItem('markdown')

        if (stored) {
          editor.value = stored
          preview.markdown = stored
          return
        }

        fetch('intro.md')
        .then(resp => resp.status === 200 && resp.text())
        .then(text => editor.value = text)
        .then(() => editor.selectionStart = 0)
        .then(syncMarkdown)
      }

      init()
    </script>
  </body>

</html>
